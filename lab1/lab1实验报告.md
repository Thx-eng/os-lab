# lab1实验报告

## 本实验中重要的知识点，以及与对应的OS原理中的知识点
| 实验中的知识点 | 对应的OS原理知识点 | 理解与阐述 |
|----------------|--------------------|-------------|
| **QEMU启动与硬件复位** | 计算机体系结构、引导 | **含义：** 实验中CPU从固定的复位地址`0x1000`开始执行。OS原理中，这是计算机启动的起点，是硬件定义的行为。<br>**关系：** 实验的具体流程（`0x1000 -> OpenSBI -> Kernel`）是引导原理的一个实例。<br>**差异：** 实验环境（QEMU）简化了流程，真实PC的引导过程（UEFI/BIOS）要复杂得多，涉及加电自检（POST）、设备枚举等。 |
| **链接脚本 (kernel.ld)** | 程序内存布局、链接与加载 | **含义：** 实验中用链接脚本精确控制内核代码段、数据段等在内存中的物理地址（`0x80200000`）。OS原理中，这涉及到可执行文件的结构和操作系统如何加载程序到内存。<br>**关系：** 链接脚本是实现指定内存布局的工具。内核首先要为自己布局，然后才能为用户进程进行布局。<br>**差异：** 内核的布局是针对物理地址的，且是静态的。而OS原理中常讨论的用户进程内存布局是针对虚拟地址的，更灵活，由操作系统在运行时动态管理。 |
| **特权级（M-mode, S-mode）** | 保护机制、双模式操作 | **含义：** 实验中OpenSBI运行在M-mode，内核运行在S-mode。这是硬件提供的隔离机制。<br>**关系：** OS原理中，双模式（用户态/内核态）是保护操作系统内核不受用户程序破坏的核心机制。M/S-mode是RISC-V对双模式思想的实现。<br>**差异：** 实验中我们关注的是固件与内核的接口，而OS原理更常强调内核与用户程序的接口。但其背后的保护思想是完全一致的。 |
| **SBI调用 (ecall)** | 系统调用、中断与异常 | **含义：** 内核通过`ecall`指令从S-mode陷入M-mode，请求OpenSBI提供的服务（如打印字符）。这是受控的权限提升。<br>**关系：** 实验中的SBI调用和OS原理中的系统调用是完全相同的底层机制，都是通过陷阱（trap）安全地跨越权限边界请求服务。<br>**差异：** 服务提供者不同。SBI调用的服务提供者是固件（OpenSBI），系统调用的服务提供者是操作系统内核。 |
| **交叉编译** | (无直接对应的OS原理知识点) | **含义：** 在一个平台（如x86 Linux）上，编译生成能在另一个平台（RISC-V）上运行的代码。这是嵌入式和操作系统开发的基本技能。 |
| **GDB调试** | (无直接对应的OS原理知识点) | **含义：** 使用GDB远程调试在QEMU中运行的内核，可以观察寄存器、内存，设置断点，单步执行。 |

## OS原理中很重要，但在实验中没有对应上的知识点

### 进程管理

实验中内核仅单线程执行，内核初始化之后直接进入死循环，无进程创建、调度、上下文切换

1. 进程定义

进程是程序的运行实体，是动态执行的过程，包含程序、数据和进程控制块（PCB）；程序是静态的指令集合，可永久存储，一个程序可对应多个进程，一个进程可包含多个程序（如调用多个库函数）。

PCB：内核维护的核心数据结构，记录进程状态、PID、寄存器组、内存地址空间、文件描述符等关键信息，所有进程的 PCB 以链表 / 表格形式组织，PCB 表大小决定了系统的并发度。

2. 并发与并行

- 并行：多个任务在同一时间同时运行，需多硬件支持例如多核 CPU、多机集群等。

- 并发：微观上同一时刻仅一个任务运行，宏观上多个任务依赖进程切换交替推进，通过 “分时共享”（交替速度足够快）模拟 “同时运行”。

并发的意义：程序交替使用 CPU 与 I/O 设备（如 CPU 计算时，I/O 设备可处理其他任务），以此能够提升资源利用率。

3. 进程切换与上下文

- 进程切换：暂停当前CPU上运行的进程，并从就绪队列里选择另一个进程继续运行，核心是 “保存上下文” 与 “恢复上下文”。

- 上下文（Context）：进程运行状态的集合，包括 CPU 寄存器（PC 程序计数器、SP 栈指针等）、CPU 状态（特权级、中断屏蔽字）、内存地址空间（页表、段表）。

- 切换实现：通过硬件指令（如 MIPS 的switch_to函数）保存当前进程寄存器到 PCB，从目标进程 PCB 恢复寄存器，完成切换。

4. 进程调度

- 调度时机：时间片耗尽、进程阻塞（如 I/O 等待）、高优先级进程唤醒、进程终止。

- 调度算法：
调度算法需平衡公平性、吞吐量、响应时间等指标，常见算法包括：

    - 时间片轮转：为每个进程分配固定时间片，轮流执行。
    - 优先级调度：优先调度高优先级进程（如系统进程优先级高于用户进程），支持抢占式（高优先级进程可打断低优先级进程）和非抢占式。
    - 多级反馈队列：结合时间片与优先级，高优先级队列时间片短（如 1ms），低优先级队列时间片长（如 100ms），进程根据运行情况在队列间迁移，若执行时间长则可降级。

- 调度数据结构：需维护就绪队列（存放可运行进程）、阻塞队列（存放等待事件的进程），通过 PCB 链表或优先队列管理进程。